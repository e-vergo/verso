# Verso (Side-by-Side Blueprint Fork)

Fork of [leanprover/verso](https://github.com/leanprover/verso), a document authoring framework for Lean developed by David Thrane Christiansen at the Lean FRO.

**Upstream:** https://github.com/leanprover/verso

## Fork Modifications

This fork extends Verso with two document genres for the [Side-by-Side Blueprint](https://github.com/e-vergo/Side-By-Side-Blueprint) toolchain, plus rainbow bracket highlighting for Lean code.

### New Genres

| Genre | Location | Purpose |
|-------|----------|---------|
| **SBSBlueprint** | `src/verso-sbs/` | Mathematical formalization blueprints with side-by-side LaTeX/Lean display |
| **VersoPaper** | `src/verso-paper/` | Academic papers with verification badges and links to formalizations |

### Rainbow Bracket Highlighting

Located in `Verso/Code/Highlighted.lean`:

- **`toHtmlRainbow`**: Renders highlighted code with depth-based bracket coloring
- 6-color cycling across `()`, `[]`, `{}` with a shared global depth counter
- Unmatched brackets marked with error styling
- Brackets inside string literals and doc comments are not colored

```lean
-- API
hl.toHtmlRainbow              -- Core rainbow bracket rendering
hl.blockHtmlRainbow ctx code  -- Block-level wrapper
hl.inlineHtmlRainbow ctx code -- Inline wrapper
```

CSS classes: `.lean-bracket-1` through `.lean-bracket-6`, `.lean-bracket-error`

### Comment Detection

`Brackets.findCommentRanges` identifies `-- ...` line comment ranges to prevent bracket matching within comments.

## SBSBlueprint Genre

For writing formalization blueprints with narrative prose and side-by-side theorem displays.

**Block directives:**

| Directive | Purpose |
|-----------|---------|
| `:::leanNode "label"` | Full side-by-side display (statement + proof + Lean code) |
| `:::paperStatement "label"` | Statement with Lean signature only |
| `:::paperFull "label"` | Statement + proof + full Lean code |
| `:::paperProof "label"` | Proof body only |
| `:::leanModule "Module.Name"` | All blueprint nodes from a module |

**Inline roles:**

| Role | Purpose |
|------|---------|
| `{nodeRef "label"}` | Cross-reference link to a blueprint node |
| `{statusDot "proven"}` | Colored status indicator dot |
| `{htmlSpan "class"}` | Span wrapper with custom CSS classes |

## VersoPaper Genre

For academic papers that link to formalizations without displaying Lean code directly.

**Block directives:**

| Directive | Purpose |
|-----------|---------|
| `:::paperStatement "label"` | LaTeX statement with link to Lean code |
| `:::paperFull "label"` | Full side-by-side display |
| `:::paperProof "label"` | Proof body only |
| `:::leanNode "label"` | Insert a blueprint node by label |
| `:::leanModule "ModuleName"` | Insert all nodes from a module |
| `:::htmlDiv "classes"` | Wrapper div with custom CSS classes |

**Inline roles:**

| Role | Purpose |
|------|---------|
| `{nodeRef "label"}` | Cross-reference link to a blueprint node |
| `{leanCode}` | Inline Lean code with syntax highlighting |
| `{htmlSpan "classes"}` | Span wrapper with custom CSS classes |

## Integration

Part of the Side-by-Side Blueprint toolchain:

```
SubVerso -> LeanArchitect -> Dress -> Runway
              |
              +-> Verso (this fork)
```

Both genres load `manifest.json` (generated by Dress) and pre-rendered artifacts from `.lake/build/dressed/`.

## Usage

```toml
# lakefile.toml
[[require]]
name = "verso"
git = "https://github.com/e-vergo/verso.git"
rev = "main"
```

```lean
import SBSBlueprint

#doc (SBSBlueprint) "My Blueprint" =>

# Chapter One

:::leanNode "thm:main"
```

## Dependencies

- **Lean:** v4.27.0
- **SubVerso:** https://github.com/e-vergo/subverso.git

## License

Apache 2.0. Core Verso framework copyright Lean FRO LLC. Fork modifications for Side-by-Side Blueprint.

For upstream Verso documentation, see [leanprover/verso](https://github.com/leanprover/verso).
