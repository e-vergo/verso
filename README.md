# Verso (Side-by-Side Blueprint Fork)

Fork of [leanprover/verso](https://github.com/leanprover/verso) for the [Side-by-Side Blueprint](https://github.com/e-vergo/Side-By-Side-Blueprint) toolchain.

**Upstream:** https://github.com/leanprover/verso

## Fork Modifications

This fork adds two document genres for formalization documentation and rainbow bracket highlighting for Lean code.

### SBSBlueprint Genre (`src/verso-sbs/`)

New genre for formalization blueprints with side-by-side LaTeX/Lean display.

**Block directives:**

| Directive | Purpose |
|-----------|---------|
| `:::leanNode "label"` | Full side-by-side display (statement + proof + Lean code) |
| `:::paperStatement "label"` | Statement with Lean signature only |
| `:::paperFull "label"` | Statement + proof + full Lean code |
| `:::paperProof "label"` | Proof body only |
| `:::leanModule "Module.Name"` | All blueprint nodes from a module |

**Inline roles:**

| Role | Purpose |
|------|---------|
| `{nodeRef "label"}` | Cross-reference link to a blueprint node |
| `{statusDot "proven"}` | Colored status indicator dot |
| `{htmlSpan "class"}` | Span wrapper with custom CSS classes |

### VersoPaper Genre (`src/verso-paper/`)

New genre for academic papers linking to formalizations without displaying Lean code directly.

**Block directives:**

| Directive | Purpose |
|-----------|---------|
| `:::paperStatement "label"` | LaTeX statement with link to Lean code |
| `:::paperFull "label"` | Full side-by-side display |
| `:::paperProof "label"` | Proof body only |
| `:::leanNode "label"` | Insert a blueprint node by label |
| `:::leanModule "ModuleName"` | Insert all nodes from a module |
| `:::htmlDiv "classes"` | Wrapper div with custom CSS classes |
| `:::htmlWrapper "tag"` | Wrapper with custom HTML tag |

**Inline roles:**

| Role | Purpose |
|------|---------|
| `{ref "label"}` | Cross-reference link to a blueprint node |
| `{lean "code"}` | Inline Lean code with syntax highlighting |
| `{span "classes"}` | Span wrapper with custom CSS classes |

### Rainbow Bracket Highlighting (`src/verso/Verso/Code/Highlighted.lean`)

Added bracket matching with depth-based coloring via the `Brackets` namespace:

| Function | Purpose |
|----------|---------|
| `renderTextWithBrackets` | Core rainbow bracket rendering |
| `collectFromHighlighted` | Bracket position extraction from highlighted code |
| `matchBrackets` | Bracket pair matching with depth tracking |

**Implementation details:**

- 6-color cycling across `()`, `[]`, `{}` with shared global depth counter
- Unmatched brackets marked with `.lean-bracket-error` class
- Brackets inside string literals and comments are not colored
- CSS classes: `.lean-bracket-1` through `.lean-bracket-6`

## Position in Toolchain

```
SubVerso -> LeanArchitect -> Dress -> Runway
              |
              +-> Verso (this fork)
```

Both genres load `manifest.json` (generated by Dress) and pre-rendered artifacts from `.lake/build/dressed/`.

## Usage

```toml
# lakefile.toml
[[require]]
name = "verso"
git = "https://github.com/e-vergo/verso.git"
rev = "main"
```

```lean
import SBSBlueprint

#doc (SBSBlueprint) "My Blueprint" =>

# Chapter One

:::leanNode "thm:main"
```

## Dependencies

- **Lean:** v4.27.0
- **SubVerso:** https://github.com/e-vergo/subverso.git (SBS fork with O(1) indexed lookups)

## Tooling

For build commands, screenshot capture, compliance validation, and archive management, see the [Archive & Tooling Hub](../archive/README.md).

## License

Apache 2.0. Core Verso framework copyright Lean FRO LLC. Fork modifications for Side-by-Side Blueprint.

For upstream Verso documentation, see [leanprover/verso](https://github.com/leanprover/verso).
